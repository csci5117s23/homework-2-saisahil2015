"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.requireAuth = void 0;
const clerk_sdk_node_1 = require("@clerk/clerk-sdk-node");
const server_1 = require("../server");
const utils_1 = require("./utils");
function requireAuth(handler, options) {
    return async (req, res) => {
        try {
            await (0, utils_1.runMiddleware)(req, res, (0, clerk_sdk_node_1.createClerkExpressRequireAuth)({
                clerkClient: server_1.clerkClient,
                apiUrl: server_1.API_URL,
                frontendApi: server_1.FRONTEND_API,
                publishableKey: server_1.PUBLISHABLE_KEY,
            })(options));
            return handler(req, res);
        }
        catch (error) {
            // @ts-ignore
            const errorData = error.data || { error: error.message };
            // @ts-ignore
            res.statusCode = error.statusCode || 401;
            /**
             * Res.json is available in express-like environments.
             * Res.send is available in express-like but also Fastify.
             */
            res.json ? res.json(errorData) : res.send(errorData);
            res.end();
        }
    };
}
exports.requireAuth = requireAuth;
