"use strict";
'use client';
Object.defineProperty(exports, "__esModule", { value: true });
exports.ClerkProvider = exports.useAwaitableNavigate = void 0;
const tslib_1 = require("tslib");
const clerk_react_1 = require("@clerk/clerk-react");
const navigation_1 = require("next/navigation");
const react_1 = tslib_1.__importStar(require("react"));
const useAwaitableNavigate = () => {
    // eslint-disable-next-line @typescript-eslint/unbound-method
    const { push, refresh } = (0, navigation_1.useRouter)();
    const pathname = (0, navigation_1.usePathname)();
    (0, react_1.useEffect)(() => {
        window.__clerk_nav = (to) => {
            return new Promise(res => {
                window.__clerk_nav_await.push(res);
                if (to === pathname) {
                    refresh();
                }
                else {
                    push(to);
                }
            });
        };
    }, [pathname]);
    (0, react_1.useEffect)(() => {
        if (typeof window.__clerk_nav_await === 'undefined') {
            window.__clerk_nav_await = [];
        }
        window.__clerk_nav_await.forEach(resolve => resolve());
        window.__clerk_nav_await = [];
    });
    return (0, react_1.useCallback)((to) => {
        return window.__clerk_nav(to);
    }, []);
};
exports.useAwaitableNavigate = useAwaitableNavigate;
function ClerkProvider(props) {
    const navigate = (0, exports.useAwaitableNavigate)();
    return (react_1.default.createElement(clerk_react_1.ClerkProvider, { navigate: navigate, ...props }));
}
exports.ClerkProvider = ClerkProvider;
